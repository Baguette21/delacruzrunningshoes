<div class="modal-overlay" (click)="onClose()">
  <div class="modal-container" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>
        <i class="bi me-2" [ngClass]="mode === 'add' ? 'bi-plus-circle-fill' : 'bi-pencil-square'"></i>
        {{ mode === 'add' ? 'Add New Shoe' : 'Edit Shoe' }}
      </h2>
      <button class="btn-close" (click)="onClose()">
        <i class="bi bi-x-lg"></i>
      </button>
    </div>

    <div class="modal-body">
      <form (ngSubmit)="onSave()" #editForm="ngForm">
        <div class="row">
          <!-- Image Upload Section -->
          <div class="col-md-12 mb-4">
            <label class="form-label">Product Image</label>
            <div 
              class="image-upload-area" 
              [class.dragging]="isDragging"
              (dragover)="onDragOver($event)"
              (dragleave)="onDragLeave($event)"
              (drop)="onDrop($event)">
              
              <div *ngIf="!imagePreview" class="upload-placeholder">
                <i class="bi bi-cloud-upload upload-icon"></i>
                <p class="upload-text">Drag & drop image here</p>
                <p class="upload-subtext">or</p>
                <label class="btn-upload">
                  <i class="bi bi-folder2-open me-2"></i>Browse Files
                  <input type="file" accept="image/*" (change)="onFileSelected($event)" hidden>
                </label>
                <p class="upload-hint">PNG, JPG up to 5MB</p>
              </div>

              <div *ngIf="imagePreview" class="image-preview-container">
                <img [src]="imagePreview" alt="Preview" class="image-preview">
                <div class="image-actions">
                  <label class="btn-change">
                    <i class="bi bi-arrow-repeat me-2"></i>Change Image
                    <input type="file" accept="image/*" (change)="onFileSelected($event)" hidden>
                  </label>
                  <button type="button" class="btn-remove" (click)="removeImage()">
                    <i class="bi bi-trash me-2"></i>Remove
                  </button>
                </div>
              </div>
            </div>
            <p class="image-note">
              <i class="bi bi-info-circle me-1"></i>
              Image will be saved as: <strong>{{ editedShoe.name | lowercase | slice:0:30 }}.png</strong>
            </p>
          </div>

          <!-- Shoe Details -->
          <div class="col-md-6">
            <div class="form-group">
              <label class="form-label">Brand *</label>
              <input type="text" class="form-control" [(ngModel)]="editedShoe.brand" name="brand" required>
            </div>
          </div>

          <div class="col-md-6">
            <div class="form-group">
              <label class="form-label">Name *</label>
              <input type="text" class="form-control" [(ngModel)]="editedShoe.name" name="name" required>
            </div>
          </div>

          <div class="col-md-12">
            <div class="form-group">
              <label class="form-label">Description</label>
              <textarea class="form-control" [(ngModel)]="editedShoe.description" name="description" rows="3"></textarea>
            </div>
          </div>

          <div class="col-md-4">
            <div class="form-group">
              <label class="form-label">Price (â‚±) *</label>
              <input type="number" step="0.01" class="form-control" [(ngModel)]="editedShoe.price" name="price" required>
            </div>
          </div>

          <div class="col-md-4">
            <div class="form-group">
              <label class="form-label">Drop Height</label>
              <select class="form-select" [(ngModel)]="editedShoe.dropHeight" name="dropHeight">
                <option *ngFor="let drop of dropHeights" [value]="drop">{{ drop }}</option>
              </select>
            </div>
          </div>

          <div class="col-md-4">
            <div class="form-group">
              <label class="form-label">Weight</label>
              <input type="text" class="form-control" [(ngModel)]="editedShoe.weight" name="weight" placeholder="e.g., 280g">
            </div>
          </div>

          <div class="col-md-4">
            <div class="form-group">
              <label class="form-label">Stability Type</label>
              <select class="form-select" [(ngModel)]="editedShoe.stabilityType" name="stabilityType">
                <option *ngFor="let type of stabilityTypes" [value]="type">{{ type }}</option>
              </select>
            </div>
          </div>

          <div class="col-md-4">
            <div class="form-group">
              <label class="form-label">Terrain Type</label>
              <select class="form-select" [(ngModel)]="editedShoe.terrainType" name="terrainType">
                <option *ngFor="let type of terrainTypes" [value]="type">{{ type }}</option>
              </select>
            </div>
          </div>

          <div class="col-md-4">
            <div class="form-group">
              <label class="form-label">Experience Type</label>
              <select class="form-select" [(ngModel)]="editedShoe.experienceType" name="experienceType">
                <option *ngFor="let type of experienceTypes" [value]="type">{{ type }}</option>
              </select>
            </div>
          </div>

          <div class="col-md-6">
            <div class="form-group">
              <label class="form-label">Total Stock Quantity</label>
              <div class="stock-input-group">
                <div class="stock-display">{{ editedShoe.stockQuantity || 0 }}</div>
                <button type="button" class="btn-manage-stock" (click)="openStockModal()">
                  <i class="bi bi-box-seam me-2"></i>Manage by Size
                </button>
              </div>
              <p class="help-text">Total stock across all sizes. Click "Manage by Size" to set stock per size.</p>
            </div>
          </div>

          <div class="col-md-12">
            <div class="form-group">
              <label class="form-label checkbox-label">
                <input type="checkbox" [(ngModel)]="editedShoe.carbonPlated" name="carbonPlated">
                <span class="checkbox-custom"></span>
                <span class="checkbox-text">
                  <i class="bi bi-lightning-charge-fill me-2"></i>Plated
                </span>
              </label>
              <p class="help-text">Check if this shoe features plate technology</p>
            </div>
          </div>
        </div>

        <div class="modal-footer">
          <button type="button" class="btn-cancel" (click)="onClose()">
            <i class="bi bi-x-circle me-2"></i>Cancel
          </button>
          <button type="submit" class="btn-save" [disabled]="!editForm.valid">
            <i class="bi me-2" [ngClass]="mode === 'add' ? 'bi-plus-circle' : 'bi-check-circle'"></i>
            {{ mode === 'add' ? 'Add Shoe' : 'Save Changes' }}
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Size Stock Management Modal -->
<app-size-stock-modal
  *ngIf="showStockModal"
  [shoe]="editedShoe"
  (save)="handleStockSave($event)"
  (close)="closeStockModal()">
</app-size-stock-modal>

