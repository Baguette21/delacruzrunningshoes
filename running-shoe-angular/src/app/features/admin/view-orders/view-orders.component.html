<div class="orders-container">
  <div class="card">
    <div class="card-header">
      <h2><i class="bi bi-receipt"></i> View Orders</h2>
      <button class="btn-refresh" (click)="loadOrders()" [disabled]="loading">
        <i class="bi bi-arrow-clockwise"></i> Refresh
      </button>
    </div>
    <div class="card-body">
      <!-- Loading State -->
      <div *ngIf="loading" class="loading-container">
        <div class="spinner"></div>
        <p>Loading orders...</p>
      </div>

      <!-- Error State -->
      <div *ngIf="error && !loading" class="error-message">
        {{ error }}
      </div>

      <!-- Empty State -->
      <div *ngIf="!loading && !error && orders.length === 0" class="empty-state">
        <i class="bi bi-inbox"></i>
        <p>No orders yet</p>
      </div>

      <!-- Orders Table -->
      <div *ngIf="!loading && !error && orders.length > 0" class="table-responsive">
        <table class="orders-table">
          <thead>
            <tr>
              <th>Order ID</th>
              <th>Customer</th>
              <th>Date</th>
              <th>Items</th>
              <th>Total</th>
              <th>Status</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let order of orders">
              <td>#{{ order.id }}</td>
              <td>
                <div class="customer-info">
                  <strong>{{ order.customerName }}</strong>
                  <small>{{ order.contactNumber }}</small>
                </div>
              </td>
              <td>{{ formatDate(order.orderDate) }}</td>
              <td>{{ getOrderItemCount(order) }}</td>
              <td class="price">₱{{ getOrderTotal(order).toFixed(2) }}</td>
              <td>
                <span class="status-badge" [ngClass]="getStatusClass(order.status)">
                  {{ order.status || 'PENDING' }}
                </span>
              </td>
              <td>
                <button class="btn-view" (click)="viewOrderDetails(order)">
                  <i class="bi bi-eye"></i> View
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<!-- Order Details Modal -->
<div class="modal-overlay" *ngIf="showOrderDetails" (click)="closeOrderDetails()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>Order Details - #{{ selectedOrder?.id }}</h3>
      <button class="btn-close" (click)="closeOrderDetails()">
        <i class="bi bi-x-lg"></i>
      </button>
    </div>

    <div class="modal-body" *ngIf="selectedOrder">
      <!-- Customer Information -->
      <div class="info-section">
        <h4><i class="bi bi-person-circle"></i> Customer Information</h4>
        <div class="info-grid">
          <div class="info-item">
            <label>Name:</label>
            <span>{{ selectedOrder.customerName }}</span>
          </div>
          <div class="info-item">
            <label>Contact:</label>
            <span>{{ selectedOrder.contactNumber }}</span>
          </div>
          <div class="info-item" *ngIf="selectedOrder.email">
            <label>Email:</label>
            <span>{{ selectedOrder.email }}</span>
          </div>
          <div class="info-item full-width">
            <label>Shipping Address:</label>
            <span>{{ selectedOrder.shippingAddress }}</span>
          </div>
        </div>
      </div>

      <!-- Order Information -->
      <div class="info-section">
        <h4><i class="bi bi-info-circle"></i> Order Information</h4>
        <div class="info-grid">
          <div class="info-item">
            <label>Order Date:</label>
            <span>{{ formatDate(selectedOrder.orderDate) }}</span>
          </div>
          <div class="info-item">
            <label>Status:</label>
            <select 
              class="status-select"
              [(ngModel)]="selectedOrder.status"
              (change)="updateOrderStatus(selectedOrder.id!, selectedOrder.status!)">
              <option *ngFor="let status of orderStatuses" [value]="status">
                {{ status }}
              </option>
            </select>
          </div>
        </div>
      </div>

      <!-- Order Items -->
      <div class="info-section">
        <h4><i class="bi bi-box-seam"></i> Order Items</h4>
        <div class="order-items">
          <div class="order-item" *ngFor="let item of selectedOrder.orderItems">
            <img 
              [src]="item.imageUrl || '/shoe_images/default.png'" 
              [alt]="item.shoeName"
              class="item-image"
              onerror="this.src='/shoe_images/default.png'">
            <div class="item-details">
              <h5>{{ item.shoeBrand }} - {{ item.shoeName }}</h5>
              <p>Size: {{ item.size }} ({{ item.gender }})</p>
              <p>Quantity: {{ item.quantity }}</p>
            </div>
            <div class="item-price">
              <span class="price">₱{{ item.price.toFixed(2) }}</span>
              <span class="subtotal">Subtotal: ₱{{ getItemSubtotal(item).toFixed(2) }}</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Order Total -->
      <div class="order-total">
        <h4>Total Amount: <span>₱{{ selectedOrder.totalAmount.toFixed(2) }}</span></h4>
      </div>
    </div>

    <div class="modal-footer">
      <button class="btn-secondary" (click)="closeOrderDetails()">
        Close
      </button>
    </div>
  </div>
</div>

